<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Matrix.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">neuralnetwork2</a> &gt; <a href="index.source.html" class="el_package">neuralnetwork.neuralnetwork.math</a> &gt; <span class="el_source">Matrix.java</span></div><h1>Matrix.java</h1><pre class="source lang-java linenums">package neuralnetwork.neuralnetwork.math;

import java.util.Arrays;
import java.util.stream.IntStream;

public class Matrix {
    
    private double[][] data;
    private final int rows;
    private final int cols;

<span class="fc" id="L12">    public Matrix(double[][] d) {</span>
<span class="fc" id="L13">        this.data = d;</span>
<span class="fc" id="L14">        this.rows = d.length;</span>
<span class="fc" id="L15">        this.cols = d[0].length;</span>
<span class="fc" id="L16">    }</span>

    public Matrix(int rows, int cols) {
<span class="fc" id="L19">        this(new double[rows][cols]);</span>
<span class="fc" id="L20">    }</span>

    /**
     * Fills in the matrix with the given 2d array
     */
    public Matrix(double[][] d, int rows, int cols) {
<span class="fc" id="L26">        this(new double[rows][cols]);</span>

<span class="fc bfc" id="L28" title="All 2 branches covered.">        for (int i = 0; i &lt; this.rows; i++) {</span>
<span class="fc bfc" id="L29" title="All 2 branches covered.">            for (int j = 0; j &lt; this.cols; j++) {</span>
<span class="fc" id="L30">                this.data[i][j] = (double) d[i][j];</span>
            }
        }
<span class="fc" id="L33">    }</span>

    /**
     * vecMultiply
     * 
     * Used to calculate outputs in forward passes
     * 
     * @param v Vector
     * @return
     */
    public Vector vecMultiply(Vector v) {

        // Transpose of current matrix
<span class="fc" id="L46">        Matrix t = Matrix.transpose(this);</span>

<span class="fc" id="L48">        double[] output = new double[rows];</span>
<span class="fc bfc" id="L49" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; i++) {</span>
<span class="fc" id="L50">            Vector a = new Vector(t.data[i]);</span>
<span class="fc" id="L51">            output[i] = a.dotProduct(v);</span>
        }
<span class="fc" id="L53">        System.out.println(&quot;Output: &quot; + Arrays.toString(v.getData()));</span>
<span class="fc" id="L54">        return new Vector(output);</span>
    }

    public static Matrix transpose(Matrix a) {
<span class="fc" id="L58">        Matrix aT = new Matrix(a.cols, a.rows);</span>
        
<span class="fc bfc" id="L60" title="All 2 branches covered.">        for (int i = 0; i &lt; a.rows; i++) {</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">            for (int j = 0; j &lt; a.cols; j++) {</span>
                // indeksit i ja j eri j채rjestyksess채, koska
                // transponoidaan
<span class="fc" id="L64">                aT.data[j][i] = a.data[i][j];</span>
            }
        }
<span class="fc" id="L67">        return aT;</span>
    }

    public Matrix map(Function fn) {
<span class="fc bfc" id="L71" title="All 2 branches covered.">       for (int i = 0; i &lt; this.data.length; i++) {</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">           for (int j = 0; j &lt; this.data[i].length; j++) {</span>
<span class="fc" id="L73">               this.data[i][j] = fn.apply(data[i][j]);</span>
           }
       }
<span class="fc" id="L76">       return this;</span>
    }

    public double[][] getData() {
<span class="fc" id="L80">        return this.data;</span>
    }

    /**
     * scalarProd
     * 
     * Scalar product of matrix and a scalar (double)
     * @param scalar
     * @return scalar * this (Matrix)
     */
    public Matrix scalarProd(double scalar) {
<span class="fc" id="L91">        return map(value -&gt; scalar * value);</span>
    }

    /**
     * matSum
     * 
     * Sum of two matrices
     * @param m (Matrix)
     * @return this + m
     */
    public Matrix matSum(Matrix m) {
<span class="fc" id="L102">        assertCorrectDimensions(m);</span>
        
<span class="fc bfc" id="L104" title="All 2 branches covered.">        for (int i = 0; i &lt; this.rows; i++) {</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">            for (int j = 0; j &lt; this.cols; j++) {</span>
<span class="fc" id="L106">                this.data[i][j] += m.data[i][j];</span>
            }
        }
<span class="fc" id="L109">        return this;</span>
    }

    /**
     * matSubtract
     * 
     * matrix subtracted by another matrix
     * @param other (Matrix)
     * @return this-other
     */
    public Matrix matSubract(Matrix other) {
<span class="fc" id="L120">        assertCorrectDimensions(other);</span>

<span class="fc bfc" id="L122" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; i++) {</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">            for (int j = 0; j &lt; cols; j++) {</span>
<span class="fc" id="L124">                this.data[i][j] -= other.data[i][j];</span>
            }
        }
<span class="fc" id="L127">        return this;</span>
    }

        /**
     * matProduct
     * Product of two matrices
     * @param o (Matrix)
     * @return this*o
     */
    public Matrix matProduct(Matrix o) {
<span class="fc" id="L137">        assertCorrectDimensions(o);</span>

<span class="fc" id="L139">        this.data = IntStream.range(0, rows)</span>
<span class="fc" id="L140">            .mapToObj(i -&gt; IntStream.range(0, o.cols)</span>
<span class="fc" id="L141">                    .mapToDouble(j -&gt; IntStream.range(0, this.cols)</span>
<span class="fc" id="L142">                            .mapToDouble(k -&gt; this.data[i][k] * o.data[k][j])</span>
<span class="fc" id="L143">                            .sum())</span>
<span class="fc" id="L144">                    .toArray()).toArray(double[][]::new);</span>
<span class="fc" id="L145">        return this;</span>
    }

    

    @Override
    public boolean equals(Object other) {
<span class="fc bfc" id="L152" title="All 2 branches covered.">        if (other == this) {</span>
<span class="fc" id="L153">            return true;</span>
        }

<span class="pc bpc" id="L156" title="1 of 2 branches missed.">        if (!(other instanceof Matrix)) {</span>
<span class="nc" id="L157">            return false;</span>
        }

<span class="fc" id="L160">        Matrix mOther = (Matrix) other;</span>

<span class="fc bfc" id="L162" title="All 2 branches covered.">        for (int i = 0; i &lt; this.rows; i++) {</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">            for (int j = 0; j &lt; this.cols; j++) {</span>
<span class="fc bfc" id="L164" title="All 2 branches covered.">                if (this.data[i][j] != mOther.data[i][j]) {</span>
<span class="fc" id="L165">                    return false;</span>
                }
            }
        }
<span class="fc" id="L169">        return true;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L174">        return &quot;Matrix: &quot; + Arrays.deepToString(this.data);</span>
        
    }



    /// Utility methods ////
    public void assertCorrectDimensions(Matrix other) {
<span class="pc bpc" id="L182" title="2 of 4 branches missed.">        if (this.cols != other.cols || this.rows != other.rows) {</span>
<span class="nc" id="L183">            throw new IndexOutOfBoundsException(&quot;matriisierotuksessa matriiseilla oltava yht채 monta saraketta ja rivi채!&quot;);</span>
        }
<span class="fc" id="L185">    }</span>

    public Matrix copy() {
<span class="fc" id="L188">        Matrix m = new Matrix(this.rows, this.cols);</span>

<span class="fc bfc" id="L190" title="All 2 branches covered.">        for (int i = 0; i &lt; rows; i++) {</span>
<span class="fc" id="L191">            m.data[i] = Arrays.copyOf(this.data[i], cols);</span>
        }
<span class="fc" id="L193">        return m;</span>
    }

    

    /// Toiminnot 
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>